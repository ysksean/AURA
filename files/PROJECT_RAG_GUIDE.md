# ë§¤ê±°ì§„ ë ˆì´ì•„ì›ƒ ìë™ ìƒì„± ì‹œìŠ¤í…œ
## í”„ë¡œì íŠ¸ êµ¬ì¡° ë° RAG ë°©ì‹ ì„¤ëª…ì„œ

**ëª©ì **: ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ì˜ ì „ì²´ êµ¬ì¡°ì™€ RAG(Retrieval-Augmented Generation) ë°©ì‹ì„ ë‹¤ë¥¸ ê°œë°œìì—ê²Œ ì„¤ëª…í•  ìˆ˜ ìˆë„ë¡ ìƒì„¸íˆ ê¸°ìˆ í•©ë‹ˆë‹¤.

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ëª©í‘œ
ì‚¬ìš©ìê°€ ì…ë ¥í•œ **í…ìŠ¤íŠ¸(ì œëª©/ë³¸ë¬¸)**ì™€ **ì´ë¯¸ì§€**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ì „ë¬¸ ì¡ì§€ ìˆ˜ì¤€ì˜ **HTML ë ˆì´ì•„ì›ƒ**ì„ ìë™ ìƒì„±í•˜ëŠ” ì‹œìŠ¤í…œ

### 1.2 í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì‚¬ìš©ì ì…ë ¥                             â”‚
â”‚         (ì œëª©, ë³¸ë¬¸, ì´ë¯¸ì§€ 1~5ì¥)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG ì‹œìŠ¤í…œ (Voyage 3.5)                   â”‚
â”‚         - ìœ ì‚¬ ë ˆì´ì•„ì›ƒ ê²€ìƒ‰                                  â”‚
â”‚         - ë””ìì¸ ì»¨í…ìŠ¤íŠ¸ ì œê³µ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LangGraph íŒŒì´í”„ë¼ì¸                        â”‚
â”‚    [Intent] â†’ [Filter] â†’ [Analyze] â†’ [Plan] â†’ [Style]      â”‚
â”‚                    â†’ [Generate] â†’ [Validate] â†’ [Quality]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ìµœì¢… ì¶œë ¥: HTML í˜ì´ì§€                      â”‚
â”‚              (A4 ê·œê²©: 794Ã—1123px)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°

```
final/
â”œâ”€â”€ main.py                 # FastAPI ì›¹ ì„œë²„ (ì§„ì…ì )
â”œâ”€â”€ rag_voyage.py           # RAG ëª¨ë“ˆ (Voyage AI ì„ë² ë”©)
â”œâ”€â”€ rag_modules.py          # RAG ëª¨ë“ˆ (BGE-M3, ë ˆê±°ì‹œ)
â”œâ”€â”€ mcp_server_langgraph.py # LangGraph ê¸°ë°˜ ë ˆì´ì•„ì›ƒ ìƒì„± ì„œë²„
â”œâ”€â”€ image_validator.py      # ì´ë¯¸ì§€ ê²€ì¦ ë° ì²˜ë¦¬
â”‚
â”œâ”€â”€ tool/
â”‚   â””â”€â”€ mcp_client.py       # MCP í´ë¼ì´ì–¸íŠ¸ (ì„œë²„ í˜¸ì¶œ)
â”‚
â”œâ”€â”€ datas/
â”‚   â””â”€â”€ final_final_dataset.json  # ë ˆì´ì•„ì›ƒ ë°ì´í„°ì…‹
â”‚
â”œâ”€â”€ chroma_db_voyage/       # ChromaDB ë²¡í„° ì €ì¥ì†Œ
â”œâ”€â”€ static/                 # ì›¹ í”„ë¡ íŠ¸ì—”ë“œ
â””â”€â”€ scripts/
    â””â”€â”€ generate_layout_dataset.py  # ë°ì´í„°ì…‹ ìƒì„± ìŠ¤í¬ë¦½íŠ¸
```

---

## 3. RAG ì‹œìŠ¤í…œ ìƒì„¸

### 3.1 RAGë€?

**RAG (Retrieval-Augmented Generation)**ëŠ” LLMì˜ ìƒì„± ëŠ¥ë ¥ì— **ì™¸ë¶€ ì§€ì‹ ê²€ìƒ‰**ì„ ê²°í•©í•œ ë°©ì‹ì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì ì¿¼ë¦¬   â”‚ â”€â”€â–¶ â”‚  ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰  â”‚ â”€â”€â–¶ â”‚   LLM ìƒì„±     â”‚
â”‚   "ì²­ëŸ‰í•œ ë·°í‹°" â”‚     â”‚  (ë²¡í„° ê²€ìƒ‰)    â”‚     â”‚  + ê²€ìƒ‰ ê²°ê³¼   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì **:
- LLMì´ í•™ìŠµí•˜ì§€ ì•Šì€ ìµœì‹ /ë„ë©”ì¸ íŠ¹í™” ì •ë³´ í™œìš© ê°€ëŠ¥
- í• ë£¨ì‹œë„¤ì´ì…˜(í™˜ê°) ê°ì†Œ
- ì‹¤ì‹œê°„ ì§€ì‹ ì—…ë°ì´íŠ¸ ê°€ëŠ¥

### 3.2 ìš°ë¦¬ ì‹œìŠ¤í…œì˜ RAG ì ìš©

#### 3.2.1 ë°ì´í„°ì…‹ êµ¬ì¡°

`final_final_dataset.json`ì— ì €ì¥ëœ ê° ë ˆì´ì•„ì›ƒ ì •ë³´:

```json
{
  "image_id": "layout_001",
  "image_path": "./image_data/layout_001.jpg",
  "mood": "Professional",
  "category": "Beauty / Skincare",
  "type": "Article",
  "description": "A clean minimalist layout with product photography...",
  "elements": [
    {"type": "title", "coordinates": {"x1": 50, "y1": 80, "x2": 700, "y2": 150}, "text": "..."},
    {"type": "body", "coordinates": {"x1": 50, "y1": 200, "x2": 400, "y2": 800}, "text": "..."},
    {"type": "figure", "coordinates": {"x1": 420, "y1": 200, "x2": 750, "y2": 500}}
  ]
}
```

---

### 3.3 ì„ë² ë”© ëª¨ë¸: Voyage AI 3.5

#### 3.3.1 ì™œ Voyage AIë¥¼ ì„ íƒí–ˆëŠ”ê°€?

| í•­ëª© | Voyage 3.5 | BGE-M3 (ê¸°ì¡´) |
|:---|:---|:---|
| **íƒ€ì…** | Cloud API | ë¡œì»¬ ëª¨ë¸ |
| **ì°¨ì›** | 512 (MRL ì§€ì›) | 1024 |
| **íŠ¹í™”** | Retrieval | General |
| **ì†ë„** | ë¹ ë¦„ (API) | ëŠë¦¼ (GPU í•„ìš”) |
| **ë¹„ìš©** | ë¬´ë£Œ 200M í† í° | ë¬´ë£Œ (í•˜ë“œì›¨ì–´ í•„ìš”) |

**Matryoshka Representation Learning (MRL)**:
- ëŸ¬ì‹œì•„ ì¸í˜•ì²˜ëŸ¼ ë²¡í„°ë¥¼ **ì¤‘ì²© êµ¬ì¡°**ë¡œ í•™ìŠµ
- 2048 â†’ 1024 â†’ 512 â†’ 256 ì°¨ì›ìœ¼ë¡œ ì¤„ì—¬ë„ ì„±ëŠ¥ ìœ ì§€
- ì €ì¥ ê³µê°„ ì ˆì•½ + ê²€ìƒ‰ ì†ë„ í–¥ìƒ

---

#### 3.3.2 MRL (Matryoshka Representation Learning) ìƒì„¸ ì„¤ëª…

**MRLì´ë€?**

2022ë…„ Google Researchì—ì„œ ë°œí‘œí•œ ì„ë² ë”© í•™ìŠµ ê¸°ë²•ìœ¼ë¡œ, **ëŸ¬ì‹œì•„ ë§ˆíŠ¸ë£Œì‹œì¹´ ì¸í˜•**ì²˜ëŸ¼ ë²¡í„°ë¥¼ **ì¤‘ì²© êµ¬ì¡°**ë¡œ í•™ìŠµí•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¼ë°˜ ì„ë² ë”© (2048ì°¨ì›)                                          â”‚
â”‚  [v1, v2, v3, v4, ..., v2048]                                  â”‚
â”‚                                                                â”‚
â”‚  âœ˜ ì•ë¶€ë¶„ë§Œ ìë¥´ë©´? â†’ ì •ë³´ ì†ì‹¤ ì‹¬ê°, ì„±ëŠ¥ ê¸‰ë½                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MRL ì„ë² ë”© (2048ì°¨ì›)                                          â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 256ì°¨ì›  â”‚ 512ì°¨ì›    â”‚ 1024ì°¨ì›      â”‚ 2048ì°¨ì›         â”‚  â”‚
â”‚  â”‚ [â–“â–“â–“â–“â–“â–“] â”‚ [â–“â–“â–“â–“â–“â–“â–“â–“] â”‚ [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“] â”‚ [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“]â”‚  â”‚
â”‚  â”‚ í•µì‹¬ì •ë³´ â”‚ + ì¶”ê°€ì •ë³´  â”‚ + ì„¸ë¶€ì •ë³´    â”‚ + ë¯¸ì„¸ì •ë³´      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  âœ“ ì•ë¶€ë¶„ë§Œ ì˜ë¼ë„ â†’ í•µì‹¬ ì •ë³´ ìœ ì§€, ì„±ëŠ¥ ê±°ì˜ ë™ì¼!            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•™ìŠµ ë°©ì‹**:

```python
# ì¼ë°˜ í•™ìŠµ: ì „ì²´ ë²¡í„°ì—ë§Œ Loss ì ìš©
loss = contrastive_loss(full_embedding)

# MRL í•™ìŠµ: ì—¬ëŸ¬ ì°¨ì›ì—ì„œ ë™ì‹œì— Loss ì ìš©
loss = (
    contrastive_loss(embedding[:256]) * 0.1 +   # 256ì°¨ì› ë¶€ë¶„
    contrastive_loss(embedding[:512]) * 0.2 +   # 512ì°¨ì› ë¶€ë¶„
    contrastive_loss(embedding[:1024]) * 0.3 +  # 1024ì°¨ì› ë¶€ë¶„
    contrastive_loss(embedding[:2048]) * 0.4    # ì „ì²´ 2048ì°¨ì›
)
```

**ë²¤ì¹˜ë§ˆí¬ ì„±ëŠ¥ ë¹„êµ** (MTEB Retrieval ê¸°ì¤€):

| ì°¨ì› | ì¼ë°˜ ì„ë² ë”© | MRL ì„ë² ë”© | ì°¨ì´ |
|:---:|:---:|:---:|:---:|
| 2048 | 0.85 | 0.85 | - |
| 1024 | 0.70 | **0.84** | +0.14 |
| 512 | 0.55 | **0.82** | +0.27 |
| 256 | 0.35 | **0.78** | +0.43 |

**ì‹¤ìš©ì  ì´ì **:

| ì´ì  | ì„¤ëª… |
|:---|:---|
| **ì €ì¥ ê³µê°„ 75% ì ˆì•½** | 2048 â†’ 512ì°¨ì› = 1/4 í¬ê¸° |
| **ê²€ìƒ‰ ì†ë„ 4ë°° í–¥ìƒ** | ë” ì‘ì€ ë²¡í„° = ë” ë¹ ë¥¸ Dot Product |
| **ë¹„ìš© ì ˆê°** | ë²¡í„° DB ì €ì¥ ë¹„ìš© ê°ì†Œ |
| **ìœ ì—°í•œ íŠ¸ë ˆì´ë“œì˜¤í”„** | ì •í™•ë„ vs ì†ë„ ìƒí™©ì— ë§ê²Œ ì¡°ì ˆ ê°€ëŠ¥ |

**Voyage AIì—ì„œ MRL ì‚¬ìš©**:

```python
# ìµœëŒ€ ì°¨ì› (ê°€ì¥ ì •í™•)
result = client.embed(texts, model="voyage-3.5", output_dimension=2048)

# MRLë¡œ ì¶•ì†Œ (ìš°ë¦¬ ì‹œìŠ¤í…œ - ê· í˜•ì¡íŒ ì„ íƒ)
result = client.embed(texts, model="voyage-3.5", output_dimension=512)

# ìµœì†Œ ì°¨ì› (ê°€ì¥ ë¹ ë¦„)
result = client.embed(texts, model="voyage-3.5", output_dimension=256)
```

> ğŸ’¡ **ìš°ë¦¬ ì‹œìŠ¤í…œì˜ ì„ íƒ**: 512ì°¨ì›
> - ì •í™•ë„: 2048ì°¨ì› ëŒ€ë¹„ ~97% ìœ ì§€
> - ì†ë„: 4ë°° ë¹ ë¥¸ ê²€ìƒ‰
> - ì €ì¥: ChromaDB ìš©ëŸ‰ 75% ì ˆì•½

#### 3.3.2 Dot Product vs Cosine Similarity

```
ê¸°ì¡´: Cosine Similarity
- ë‘ ë²¡í„°ì˜ ê°ë„(ë°©í–¥) ë¹„êµ
- ì •ê·œí™” í•„ìš”
- ìˆ˜ì‹: cos(Î¸) = (A Â· B) / (||A|| ||B||)

í˜„ì¬: Dot Product (Inner Product)
- ë‘ ë²¡í„°ì˜ ë‚´ì 
- ì •ê·œí™”ëœ ë²¡í„°ì—ì„œëŠ” Cosineê³¼ ë™ì¼
- ìˆ˜ì‹: A Â· B = Î£(ai Ã— bi)
- ì¥ì : ê³„ì‚°ì´ ë” ë‹¨ìˆœí•˜ê³  ë¹ ë¦„
```

Voyage AIëŠ” **ì •ê·œí™”ëœ ë²¡í„°**ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ Dot Product = Cosine Similarity

---

### 3.4 ChromaDB ì„¤ì •

#### 3.4.1 ì»¬ë ‰ì…˜ ìƒì„±

```python
self.chroma_client = chromadb.PersistentClient(path="./chroma_db_voyage")
self.collection = self.chroma_client.get_or_create_collection(
    name="magazine_layouts_voyage",
    metadata={"hnsw:space": "ip"}  # Inner Product (Dot Product)
)
```

| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|:---|:---|:---|
| `path` | `./chroma_db_voyage` | ì˜êµ¬ ì €ì¥ ê²½ë¡œ |
| `name` | `magazine_layouts_voyage` | ì»¬ë ‰ì…˜ ì´ë¦„ |
| `hnsw:space` | `ip` | ìœ ì‚¬ë„ ë©”íŠ¸ë¦­ (Inner Product) |

#### 3.4.2 HNSW ì•Œê³ ë¦¬ì¦˜

ChromaDBëŠ” **HNSW (Hierarchical Navigable Small World)** ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Layer 3 (ìµœìƒìœ„)               â”‚
â”‚     â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—                   â”‚
â”‚     â”‚               â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚  Layer 2      â”‚                   â”‚
â”‚     â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—               â”‚
â”‚     â”‚   â”‚   â”‚       â”‚   â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚   â”‚   â”‚       â”‚   â”‚  Layer 1      â”‚
â”‚   â—â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—       â”‚
â”‚   â”‚ â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â”‚
â”œâ”€â”€â”€â”¼â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚ â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â”‚
â”‚   â—â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—   â”‚
â”‚   Layer 0 (ëª¨ë“  ë°ì´í„°)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **ì¥ì **: O(log N) ê²€ìƒ‰ ë³µì¡ë„
- **ë‹¨ì **: ì¸ë±ìŠ¤ ë¹Œë“œ ì‹œê°„ í•„ìš”

---

### 3.5 ì¸ë±ì‹± í”„ë¡œì„¸ìŠ¤

#### 3.5.1 ë¬¸ì„œ í…ìŠ¤íŠ¸ í¬ë§·íŒ…

```python
def _format_layout_text(self, item: Dict) -> str:
    """ë ˆì´ì•„ì›ƒ ë°ì´í„°ë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜"""
    text_parts = [
        f"Category: {item.get('category', 'Unknown')}",  # "Beauty / Skincare"
        f"Type: {item.get('type', 'Unknown')}",          # "Article"
        f"Mood: {item.get('mood', 'Unknown')}",          # "Professional"
        f"Description: {item.get('description', '')}"    # "A clean minimalist..."
    ]
    
    # ë ˆì´ì•„ì›ƒ ë‚´ í…ìŠ¤íŠ¸ ìš”ì†Œë„ í¬í•¨
    for elem in item.get('elements', []):
        if elem.get('text'):
            text_parts.append(elem['text'])
    
    return "\n".join(text_parts)
```

**ì˜ˆì‹œ ì¶œë ¥**:
```
Category: Beauty / Skincare
Type: Article
Mood: Professional
Description: A clean minimalist layout with product photography
```

#### 3.5.2 êµ¬ì¡°ì  ë©”íƒ€ë°ì´í„° ì¶”ì¶œ

```python
# ì´ë¯¸ì§€ ê°œìˆ˜ ê³„ì‚°
image_elements = [e for e in elements if e['type'] == 'figure']
img_count = len(image_elements)

# ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ ë¶„ì„ (ê°€ì¥ í° ì´ë¯¸ì§€ ê¸°ì¤€)
largest_img = max(image_elements, key=lambda x: width * height)
if width > height * 1.1:
    layout_ratio = "Horizontal"
elif height > width * 1.1:
    layout_ratio = "Vertical"
else:
    layout_ratio = "Square"
```

| ë©”íƒ€ë°ì´í„° | ê°’ ì˜ˆì‹œ | ìš©ë„ |
|:---|:---|:---|
| `image_count` | 3 | í•„í„°ë§ |
| `layout_ratio` | "Vertical" | í•„í„°ë§ |
| `type` | "Article" / "Cover" | í•„í„°ë§ |
| `mood` | "Professional" | ë²¡í„° ê²€ìƒ‰ |
| `category` | "Beauty" | ë²¡í„° ê²€ìƒ‰ |

#### 3.5.3 Voyage API í˜¸ì¶œ

```python
def _get_voyage_embeddings(self, texts: List[str], input_type: str) -> List[List[float]]:
    """
    Voyage AI APIë¡œ ì„ë² ë”© ìƒì„±
    
    Args:
        texts: ì„ë² ë”©í•  í…ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸
        input_type: "document" (ì¸ë±ì‹±) ë˜ëŠ” "query" (ê²€ìƒ‰)
    """
    result = self.client.embed(
        texts,
        model="voyage-3.5",
        input_type=input_type,         # document vs query êµ¬ë¶„
        output_dimension=512           # MRL: 2048â†’512ë¡œ ì¶•ì†Œ
    )
    return result.embeddings
```

> âš ï¸ **ì¤‘ìš”**: `input_type`ì´ ë‹¤ë¥´ë©´ ê°™ì€ í…ìŠ¤íŠ¸ë„ **ë‹¤ë¥¸ ë²¡í„°** ìƒì„±
> - `document`: ì €ì¥í•  ë¬¸ì„œìš© ë²¡í„°
> - `query`: ê²€ìƒ‰ ì¿¼ë¦¬ìš© ë²¡í„°

---

### 3.6 ìºì‹± ë©”ì»¤ë‹ˆì¦˜

#### 3.6.1 ìºì‹œ ì €ì¥ êµ¬ì¡°

```python
# ìºì‹œ íŒŒì¼: ./index_cache_voyage.pkl
{
    'version': 'voyage-1.0-ip-a3f2b1c8',  # ë²„ì „ í•´ì‹œ
    'doc_map': {...},                      # ë¬¸ì„œ ID â†’ ì›ë³¸ ë°ì´í„° ë§¤í•‘
    'doc_ids': [...]                       # ë¬¸ì„œ ID ë¦¬ìŠ¤íŠ¸
}
```

#### 3.6.2 ìºì‹œ ë¬´íš¨í™” ì¡°ê±´

```python
def _load_from_cache(self) -> bool:
    # 1. ìºì‹œ íŒŒì¼ ì—†ìŒ
    if not os.path.exists(self.cache_path):
        return False
    
    # 2. ë°ì´í„°ì…‹ì´ ìºì‹œë³´ë‹¤ ìµœì‹ 
    if os.path.getmtime(DATASET_PATH) > os.path.getmtime(self.cache_path):
        return False  # ì¬ì¸ë±ì‹± í•„ìš”
    
    # 3. ë²„ì „ ë¶ˆì¼ì¹˜ (ì½”ë“œ ë³€ê²½ë¨)
    if cached_version != self.CACHE_VERSION:
        return False
    
    return True
```

**ë²„ì „ í•´ì‹œ ìƒì„±**:
```python
import hashlib, inspect

logic_source = inspect.getsource(self.index_data)  # ì¸ë±ì‹± í•¨ìˆ˜ ì†ŒìŠ¤
logic_hash = hashlib.md5(logic_source.encode()).hexdigest()[:8]
distance_metric = "ip"

CACHE_VERSION = f"voyage-1.0-{distance_metric}-{logic_hash}"
# â†’ "voyage-1.0-ip-a3f2b1c8"
```

---

### 3.7 ê²€ìƒ‰ íë¦„

#### 3.7.1 ì „ì²´ ê²€ìƒ‰ ê³¼ì •

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì‚¬ìš©ì ì…ë ¥ ë¶„ì„ (Gemini)                                 â”‚
â”‚    images, title, body â†’ {"mood": "Professional", ...}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ê²€ìƒ‰ ì¿¼ë¦¬ êµ¬ì„±                                            â”‚
â”‚    "Professional Calm White Beauty Skincare Balanced"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. í•„í„° êµ¬ì„± (Cascading Fallback)                           â”‚
â”‚    ì‹œë„ 1: {type: Article, image_count: 3, layout_ratio: V} â”‚
â”‚    ì‹œë„ 2: {type: Article, image_count: 3}                  â”‚
â”‚    ì‹œë„ 3: {type: Article}                                  â”‚
â”‚    ì‹œë„ 4: {} (í•„í„° ì—†ìŒ)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Voyage API ì¿¼ë¦¬ ì„ë² ë”©                                    â”‚
â”‚    query â†’ [0.234, -0.156, 0.089, ...]  (512ì°¨ì›)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ChromaDB ë²¡í„° ê²€ìƒ‰ (Dot Product)                          â”‚
â”‚    query_vector Â· doc_vectors â†’ similarity scores          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Top-K ê²°ê³¼ ë°˜í™˜                                           â”‚
â”‚    [{image_id: "layout_042", similarity: 0.89, ...}, ...]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.7.2 Cascading Fallback ì „ëµ

```python
# main.pyì—ì„œ êµ¬í˜„
def search_with_fallback(query, filters):
    filter_attempts = [
        {'type': db_type, 'image_count': img_count, 'layout_ratio': ratio},
        {'type': db_type, 'image_count': img_count},
        {'type': db_type},
        {}  # í•„í„° ì—†ìŒ
    ]
    
    for f in filter_attempts:
        results = retriever.search(query, filters=f, top_k=5)
        if len(results) > 0:
            return results
    
    return []
```

ì´ ì „ëµì€ í•„í„°ê°€ ë„ˆë¬´ **restrictive**í•  ë•Œ ìë™ìœ¼ë¡œ ì™„í™”:

```
ğŸ” Trying filters: {type: Article, image_count: 3, layout_ratio: Vertical}
   Found 0 results
ğŸ” Trying filters: {type: Article, image_count: 3}
   Found 0 results
ğŸ” Trying filters: {type: Article}
   Found 2 results âœ“
```

#### 3.7.3 ê²€ìƒ‰ ê²°ê³¼ í™œìš©

ê²€ìƒ‰ëœ ë ˆì´ì•„ì›ƒ ì •ë³´ëŠ” **LangGraph ë…¸ë“œ**ë¡œ ì „ë‹¬:

```python
# ê²€ìƒ‰ ê²°ê³¼ ì¤‘ ê°€ì¥ ìœ ì‚¬í•œ ë ˆì´ì•„ì›ƒ
best_match = results[0]
layout_data = retriever.get_layout(best_match['image_id'])

# LangGraphì— ì „ë‹¬ë˜ëŠ” ì»¨í…ìŠ¤íŠ¸
plan_json = {
    "reference_id": layout_data['image_id'],
    "elements": layout_data['elements'],  # ì¢Œí‘œ ì •ë³´
    "spatial_summary": "3 images, 2 text blocks. Top-heavy.",
    "suggested_strategy": "Mosaic or Grid"
}
```

**HTML Generatorê°€ ì°¸ì¡°í•˜ëŠ” ì •ë³´**:
- ì°¸ì¡° ë ˆì´ì•„ì›ƒì˜ **ìš”ì†Œ ë°°ì¹˜** (ì¢Œí‘œ)
- ì´ë¯¸ì§€/í…ìŠ¤íŠ¸ **ë¹„ìœ¨ ë¶„ì„**
- ì¶”ì²œ **ë ˆì´ì•„ì›ƒ ì „ëµ** (Grid, Float ë“±)

---

### 3.8 ì „ì²´ ì½”ë“œ ì˜ì‚¬ íë¦„

```python
# 1. ì´ˆê¸°í™”
analyzer = GeminiAnalyzer()          # Gemini 2.5 Flash
retriever = VoyageRetriever()        # Voyage 3.5 + ChromaDB

# 2. ì‚¬ìš©ì ì…ë ¥ ìˆ˜ì‹ 
images = [img1, img2, img3]
title = "Functional Skincare + Light Protection"
body = "After applying functional skincare products..."

# 3. Gemini ë¶„ì„
analysis = analyzer.analyze_page(images, title, body)
# â†’ {"mood": "Professional", "category": "Beauty", "type": "Balanced"}

# 4. ê²€ìƒ‰ ì¿¼ë¦¬ êµ¬ì„±
query = f"{analysis['mood']} {analysis['category']} {analysis['description']}"

# 5. RAG ê²€ìƒ‰
results = retriever.search(
    query=query,
    filters={"type": "Article", "image_count": 3},
    top_k=5
)

# 6. ìµœìƒìœ„ ê²°ê³¼ë¡œ ë ˆì´ì•„ì›ƒ íŒíŠ¸ êµ¬ì„±
best_layout = retriever.get_layout(results[0]['image_id'])

# 7. LangGraphë¡œ HTML ìƒì„±
html = mcp_client.generate_layout(
    headline=title,
    body=body,
    image_data=images,
    vision_json=analysis,
    design_json=best_layout
)
```

---

## 4. LangGraph íŒŒì´í”„ë¼ì¸

### 4.1 ë…¸ë“œ êµ¬ì„±

```mermaid
graph LR
    A[Intent Classifier] --> B[Content Filter]
    B --> C[Image Analyzer]
    C --> D[Layout Planner]
    D --> E[Typography Styler]
    E --> F[HTML Generator]
    F --> G[Validator]
    G --> H[Quality Checker]
    H -->|Pass| I[END]
    H -->|Fail| F
```

### 4.2 ê° ë…¸ë“œ ì—­í• 

| ë…¸ë“œ | ì—­í•  | ì¶œë ¥ |
|:---|:---|:---|
| **Intent Classifier** | ì¡ì§€ ê´€ë ¨ ìš”ì²­ì¸ì§€ í™•ì¸ | `intent_valid: true/false` |
| **Content Filter** | ë¶€ì ì ˆ ì½˜í…ì¸  í•„í„°ë§ | `content_safe: true/false` |
| **Image Analyzer** | HERO ì´ë¯¸ì§€ ì„ ì •, ë°°ì¹˜ ê²°ì • | `{"hero_index": 0, "placements": {...}}` |
| **Layout Planner** | float vs multi-column ê²°ì • | `{"layout_type": "multi-column"}` |
| **Typography Styler** | í°íŠ¸ í¬ê¸°, ê°•ì¡° êµ¬ë¬¸ ê²°ì • | `{"accent_color": "text-blue-600"}` |
| **HTML Generator** | ìµœì¢… HTML ìƒì„± | `<div class="w-[794px]...">...</div>` |
| **Validator** | ê¸°ë³¸ ê²€ì¦ (ì´ë¯¸ì§€ ëˆ„ë½ ë“±) | `{"passed": true/false}` |
| **Quality Checker** | ìƒì„¸ í’ˆì§ˆ ê²€ìˆ˜ + ì¬ì‹œë„ | `{"issues": [], "fixes": []}` |

### 4.3 ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜

Quality Checkerì—ì„œ ë¬¸ì œ ë°œê²¬ ì‹œ HTML Generatorë¡œ **ë£¨í”„ë°±**:

```
HTML Generator â†’ Validator â†’ Quality Checker
       â†‘                              â”‚
       â”‚        âŒ ì‹¤íŒ¨ (retry < 3)   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ìµœëŒ€ **3íšŒ ì¬ì‹œë„** í›„ ìµœì¢… HTML ë°˜í™˜

---

## 5. í•µì‹¬ íŒŒì¼ ì„¤ëª…

### 5.1 main.py (FastAPI ì„œë²„)

```python
@app.post("/analyze")
async def analyze_pages(...):
    # 1. ì´ë¯¸ì§€ ë¡œë“œ
    # 2. Geminië¡œ ì½˜í…ì¸  ë¶„ì„
    # 3. RAG ê²€ìƒ‰ (ìœ ì‚¬ ë ˆì´ì•„ì›ƒ)
    # 4. MCP ì„œë²„ í˜¸ì¶œ (LangGraph)
    # 5. ìµœì¢… HTML ë°˜í™˜
```

### 5.2 rag_voyage.py (RAG ëª¨ë“ˆ)

```python
class VoyageRetriever:
    def __init__(self):
        # Voyage AI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        # ChromaDB ì—°ê²°
        # ë°ì´í„°ì…‹ ì¸ë±ì‹±

    def search(self, query, filters, top_k=5):
        # 1. ì¿¼ë¦¬ ì„ë² ë”© ìƒì„±
        # 2. ChromaDB ë²¡í„° ê²€ìƒ‰
        # 3. ë©”íƒ€ë°ì´í„° í•„í„° ì ìš©
        # 4. ìƒìœ„ Kê°œ ê²°ê³¼ ë°˜í™˜
```

### 5.3 mcp_server_langgraph.py (ìƒì„± ì„œë²„)

```python
def build_magazine_graph():
    graph = StateGraph(MagazineState)
    
    # ë…¸ë“œ ì¶”ê°€
    graph.add_node("intent_classifier", ...)
    graph.add_node("html_generator", ...)
    graph.add_node("quality_checker", ...)
    
    # ì—£ì§€ ì—°ê²°
    graph.add_edge("validator", "quality_checker")
    graph.add_conditional_edges(
        "quality_checker",
        quality_check_router,
        {"retry": "html_generator", "end": END}
    )
    
    return graph.compile()
```

---

## 6. ë°ì´í„° íë¦„ ìš”ì•½

```
[ì‚¬ìš©ì ì…ë ¥]
     â”‚
     â–¼
[main.py] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                  â”‚
     â–¼                                                  â”‚
[rag_voyage.py]                                        â”‚
     â”‚ 1. Geminië¡œ ì½˜í…ì¸  ë¶„ì„                          â”‚
     â”‚ 2. Voyageë¡œ ì¿¼ë¦¬ ì„ë² ë”©                          â”‚
     â”‚ 3. ChromaDBì—ì„œ ìœ ì‚¬ ë ˆì´ì•„ì›ƒ ê²€ìƒ‰               â”‚
     â”‚                                                  â”‚
     â–¼                                                  â”‚
[mcp_client.py] â”€â”€â”€â–¶ [mcp_server_langgraph.py]        â”‚
                            â”‚                          â”‚
                            â–¼                          â”‚
                     [LangGraph 8ë…¸ë“œ]                 â”‚
                            â”‚                          â”‚
                            â–¼                          â”‚
                     [ìµœì¢… HTML]                       â”‚
                            â”‚                          â”‚
â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
[ë¸Œë¼ìš°ì € ë Œë”ë§]
```

---

## 7. í•µì‹¬ ê°œë… ì •ë¦¬

| ê°œë… | ì„¤ëª… |
|:---|:---|
| **RAG** | ê²€ìƒ‰ + ìƒì„±ì„ ê²°í•©í•˜ì—¬ LLM ì¶œë ¥ í’ˆì§ˆ í–¥ìƒ |
| **Voyage 3.5** | ê²€ìƒ‰ì— íŠ¹í™”ëœ ì„ë² ë”© ëª¨ë¸ (512ì°¨ì›) |
| **ChromaDB** | ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ (ìœ ì‚¬ë„ ê²€ìƒ‰) |
| **LangGraph** | LLM ì›Œí¬í”Œë¡œìš°ë¥¼ ê·¸ë˜í”„ë¡œ ê´€ë¦¬ |
| **MCP** | Model Context Protocol (ì„œë²„-í´ë¼ì´ì–¸íŠ¸ í†µì‹ ) |
| **Quality Checker** | ìƒì„±ëœ HTML í’ˆì§ˆ ê²€ìˆ˜ + ì¬ì‹œë„ |

---

## 8. í™•ì¥ í¬ì¸íŠ¸

1. **ë°ì´í„°ì…‹ í™•ì¥**: `scripts/generate_layout_dataset.py`ë¡œ ìƒˆ ì´ë¯¸ì§€ ë¶„ì„
2. **ì„ë² ë”© ëª¨ë¸ ë³€ê²½**: `rag_voyage.py`ì˜ `Config` ìˆ˜ì •
3. **ë…¸ë“œ ì¶”ê°€**: `mcp_server_langgraph.py`ì˜ `build_magazine_graph()` ìˆ˜ì •
4. **í’ˆì§ˆ ê¸°ì¤€ ì¡°ì •**: `html_quality_checker_node()` íœ´ë¦¬ìŠ¤í‹± ìˆ˜ì •

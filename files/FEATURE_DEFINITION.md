# AI Magazine Layout Generator - 기능정의서

---

## 프로젝트 개요

| 항목 | 내용 |
|:---|:---|
| 프로젝트명 | AI Magazine Layout Generator |
| 개발 기간 | 2025.12.24 ~ 2026.01.15 (약 3주) |
| 팀 구성 | 4명 (유신, 규리, 명래, 승민) |
| 핵심 기술 | LangGraph, MCP, RAG, Gemini Vision |

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           AI Magazine Layout Generator                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐    │
│  │   Intent    │──▶│   Safety    │──▶│   Vision    │──▶│   Planner   │    │
│  │   Router    │   │   Agent     │   │   Agent     │   │   Agent     │    │
│  └─────────────┘   └─────────────┘   └─────────────┘   └─────────────┘    │
│                                                               │             │
│                                            ┌──────────────────┴───────┐    │
│                                            │                          │    │
│                                            ▼                          ▼    │
│                                   ┌─────────────┐            ┌─────────┐   │
│                                   │   Editor    │            │Director │   │
│                                   │   Agent     │            │ Agent   │   │
│                                   └──────┬──────┘            └────┬────┘   │
│                                          │                        │        │
│                                          └────────────┬───────────┘        │
│                                                       │                    │
│                                                       ▼                    │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────────────────────────┐  │
│  │  Critique   │◀──│  Publisher  │◀──│         MCP Server              │  │
│  │   Agent     │   │   Agent     │   │  (Nano Banana Layout Service)   │  │
│  └──────┬──────┘   └─────────────┘   └─────────────────────────────────┘  │
│         │                                                                  │
│         └────────────▶ Retry Loop (품질 미달 시)                           │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  [Data Layer]                                                               │
│  ┌─────────────────────┐   ┌─────────────────────┐                         │
│  │  Vector DB (RAG)    │   │  Template Registry  │                         │
│  │  - Voyage 3.5       │   │  - 122+ Layouts     │                         │
│  │  - ChromaDB         │   │  - JSON Specs       │                         │
│  └─────────────────────┘   └─────────────────────┘                         │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 핵심 기능 정의

### 1. Intent Router (의도 분류)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 유신 |
| 설명 | 사용자 입력의 의도를 분류하여 적절한 파이프라인으로 라우팅 |
| 입력 | 사용자 텍스트, 이미지 |
| 출력 | 의도 분류 결과 (잡지 레이아웃 요청 여부) |

---

### 2. Safety Agent (콘텐츠 필터링)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 승민 |
| 설명 | 부적절한 콘텐츠 필터링 및 PII(개인정보) 탐지 |
| 핵심 기능 | |
| - Pydantic 출력 정형화 | LLM 응답을 JSON 포맷으로 명확하게 구조화 |
| - Hybrid Detection | 정규표현식 + LLM 병합하여 정확도 향상 |
| - 문맥 인식 | 매거진 고유의 상업적/예술적 가치 보존 (인터뷰이 이름, 브랜드명 허용) |

---

### 3. Vision Agent (이미지 분석)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 규리 |
| 설명 | 이미지 분석 및 레이아웃 추천 |
| 핵심 기능 | |
| - 공간 분석 | Maximal Empty Rectangle 전략으로 최적 텍스트 배치 영역 탐색 |
| - 색상 추출 | 이미지의 Primary Color 추출하여 디자인에 반영 |
| - 피사체 추적 | dominant_position을 CSS object-position에 매핑 |
| - 5가지 카테고리 분류 | 콘텐츠 타입 자동 분류 및 레이아웃별 추천점수 부여 |

---

### 4. Planner Agent (기획)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 유신, 명래 |
| 설명 | 콘텐츠 구조 기획 및 RAG 검색 |
| 핵심 기능 | |
| - RAG 검색 | Voyage 3.5 임베딩으로 유사 레이아웃 검색 |
| - 3-Stage Fallback | 검색 실패 방지를 위한 3단계 완화 전략 |
| - 레이아웃 후보 생성 | 이미지 개수에 따른 Dual/Triptych/Grid 자동 추천 |

---

### 5. Director Agent (디자인 지휘)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 유신, 명래 |
| 설명 | 디자인 스펙 결정 (색상, 폰트, 레이아웃) |
| 핵심 기능 | |
| - 창의성 설정 | temperature 0.7~0.9로 디자인 다양성 확보 |
| - 변수 주입 | Vision 분석값 강제 사용으로 환각 방지 |
| - 8가지 페르소나 | Elegant, Bold 등 상황별 스타일 유도 |

---

### 6. Editor Agent (원고 작성)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 승민, 명래 |
| 설명 | 매거진 원고 생성 및 편집 |
| 핵심 기능 | |
| - Tone/Length 분리 | 고급스럽지만 간결한 글 제어 |
| - 입력 유형 판별 | 50자 이상이면 직접 작성으로 간주 |
| - 지능형 서브헤드 추출 | 인상적인 Hook만 선별 |

---

### 7. Publisher Agent (발행)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 유신 |
| 설명 | 최종 HTML 조립 및 발행 |
| 핵심 기능 | |
| - Placeholder 치환 | 이미지 변수명만 전달, 최종 단계에서 실제 데이터 주입 |
| - 다중 이미지 대응 | 여러 장 이미지 배치 구조 확장 |
| - 병렬 처리 | asyncio.gather로 동시 실행 |

---

### 8. Critique Agent (품질 검수)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 유신 |
| 설명 | 생성된 HTML 품질 검수 및 재시도 루프 |
| 핵심 기능 | |
| - Self-Validation | 겹침률 2% 미만 달성 |
| - Absolute Rules | 오버랩 금지, 이미지 개수 준수, 텍스트 보존 |
| - 조건부 재시도 | 품질 점수 기반 동적 재생성 |

---

### 9. MCP Server (렌더링 엔진)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 규리, 명래 |
| 설명 | 실제 HTML 렌더링을 담당하는 마이크로서비스 |
| 핵심 기능 | |
| - LangGraph 통합 | 6개 노드 멀티 에이전트 파이프라인 |
| - Multimodal Prompting | 레퍼런스 이미지 기반 구조 모방 |
| - Smart Selection | 후보 3개 중 최적 레이아웃 자동 선택 |

---

### 10. RAG System (검색 증강 생성)

| 항목 | 내용 |
|:---|:---|
| 담당자 | 규리, 명래, 승민 |
| 설명 | 벡터 DB 기반 레이아웃 검색 |
| 핵심 기능 | |
| - Voyage 3.5 임베딩 | 512차원 MRL, API 기반 |
| - Hybrid Scoring | Dense(0.7) + Sparse(0.3) 가중치 |
| - Index Caching | 초기화 속도 20배 향상 (10s → 0.5s) |
| - 4-Stage Fallback | 검색 성공률 100% 달성 |

---

## 데이터 스키마

### State (공유 상태)

| 필드 | 타입 | 설명 |
|:---|:---|:---|
| user_input | dict | 제목/소제목/본문 |
| image_data | list | Base64 이미지 리스트 |
| vision_analysis | dict | 이미지 분석 결과 |
| layout_plan | dict | 레이아웃 계획 |
| design_spec | dict | 디자인 스펙 |
| html_output | str | 생성된 HTML |
| quality_score | int | 품질 점수 (0-100) |

---

## 성능 지표 (KPI)

| 지표 | 개선 전 | 개선 후 | 비고 |
|:---|:---:|:---:|:---|
| 생성 속도 | 120초 | 25초 | 79% 단축 (병렬 처리) |
| 데이터셋 | 0개 | 122개 | Gemini Vision 자동화 |
| 오류율(겹침) | 40% | 2% 미만 | Self-Validation |
| 검색 초기화 | 10초 | 0.5초 | Index Caching |
| 데이터 전송량 | 3MB | 20bytes | Placeholder 치환 |

---

## 기술 스택

| 분류 | 기술 |
|:---|:---|
| **Framework** | LangGraph, FastAPI |
| **LLM** | Gemini 2.5 Flash/Pro |
| **Embedding** | Voyage 3.5 (512D, MRL) |
| **Vector DB** | ChromaDB |
| **Frontend** | HTML5 + Tailwind CSS |
| **Protocol** | MCP (Model Context Protocol) |

# Validator Node (HTML Quality Checker)

---

## 슬라이드 디자인

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│   ┌─────────────────────────────────────────────────────────────┐  │
│   │  LangGraph Pipeline                                          │  │
│   │                                                              │  │
│   │  ... ──▶│Typography│──▶│   HTML   │──▶│Validator │──▶│Quality│  │
│   │         │  Styler  │   │Generator │   │          │   │Checker│  │
│   │         └──────────┘   └──────────┘   └──────────┘   │★ HERE │  │
│   │                                                      └───────┘  │
│   │                                                          │      │
│   │                              ┌───────────────────────────┘      │
│   │                              ▼                                  │
│   │                       ┌────────────┐                            │
│   │                       │  Quality   │                            │
│   │                       │  Router    │                            │
│   │                       └─────┬──────┘                            │
│   │                      ┌──────┴──────┐                            │
│   │                      ▼             ▼                            │
│   │                 [ PASS ]      [ RETRY ]                         │
│   │                    END      → HTML Generator                    │
│   │                             (Max 3회)                           │
│   └─────────────────────────────────────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 2단계 검증 시스템

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│   ┌─────────────────────────┐    ┌─────────────────────────────┐   │
│   │   Stage 1: Validator    │ ──▶│  Stage 2: Quality Checker   │   │
│   │   (구조 검증)            │    │  (품질 검수)                 │   │
│   ├─────────────────────────┤    ├─────────────────────────────┤   │
│   │                         │    │                             │   │
│   │ ☑️ 이미지 플레이스홀더   │    │ 📐 이미지 높이 분석         │   │
│   │    존재 여부            │    │    (개수별 권장 높이)       │   │
│   │                         │    │                             │   │
│   │ ☑️ absolute 남용 감지   │    │ 📏 패딩/마진 과다 감지      │   │
│   │    (5개 초과 시 경고)   │    │    (p-8+, mb-6+ 경고)       │   │
│   │                         │    │                             │   │
│   │ ☑️ 하단 패딩 존재       │    │ 🔤 본문 길이별 폰트 권장    │   │
│   │    (pb-8/10/12)         │    │    (2000자↑ → text-[10px])  │   │
│   │                         │    │                             │   │
│   │ ☑️ <img> 태그 존재      │    │ 📊 오버플로우 정밀 계산     │   │
│   │                         │    │    (A4: 1123px 기준)        │   │
│   │                         │    │                             │   │
│   └─────────────────────────┘    └─────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 발표 대본 (약 1분)

---

> **"파이프라인의 마지막 노드, Validator입니다.**
> 
> **2단계 검증 시스템으로 구성됩니다.**
> 
> ---
> 
> **첫 번째, 구조 검증입니다.**
> 
> 모든 이미지 플레이스홀더가 존재하는지,
> 
> absolute 포지션 남용으로 겹침 위험은 없는지,
> 
> 하단 패딩과 img 태그가 제대로 있는지 확인합니다.
> 
> ---
> 
> **두 번째, 품질 검수입니다.**
> 
> 이미지 개수에 따른 권장 높이를 계산하고,
> 
> 패딩과 마진이 과도하지 않은지 분석합니다.
> 
> 본문이 2000자가 넘으면 10px 폰트를 권장하고,
> 
> 최종적으로 A4 페이지 1123px 기준으로 **오버플로우 여부를 정밀 계산**합니다.
> 
> ---
> 
> 검증 실패 시, **Quality Router가 HTML Generator로 재시도**를 지시합니다.
> 
> 최대 3회까지 재시도하며, 매번 구체적인 수정 지시를 함께 전달합니다."

---

## 핵심 포인트

| 항목 | 내용 |
|:---|:---|
| **노드 위치** | 파이프라인 마지막 (7~8번째) |
| **2단계 검증** | 구조 검증 → 품질 검수 |
| **재시도 로직** | Quality Router → 최대 3회 |
| **특징** | 구체적 수정 지시 + 오버플로우 계산 |

---

## 이미지 개수별 권장 높이

| 이미지 수 | 권장 높이 (px) |
|:---:|:---:|
| 1장 | 350 ~ 500 |
| 2장 | 220 ~ 320 |
| 3장 | 150 ~ 220 |
| 4장 | 120 ~ 180 |
| 5장+ | 100 ~ 150 |

> **전체 이미지 높이 예산**: 3장 이상 시 최대 700px

---

## 본문 길이별 폰트 권장

| 본문 길이 | 권장 폰트 |
|:---:|:---:|
| 2000자 초과 | `text-[10px]` |
| 1500~2000자 | `text-xs` |
| 1000~1500자 | `text-sm` |
| 1000자 미만 | 기본 |

---

## 코드 스니펫 (Quality Router)

```python
def quality_check_router(state: MagazineState) -> str:
    """품질 검사 결과에 따라 다음 노드 결정"""
    quality_result = state.get("html_quality_check", {})
    retry_count = state.get("retry_count", 0)
    
    if quality_result.get("passed", False):
        return "end"              # ✅ PASS → 종료
    elif retry_count >= 3:
        return "end"              # ❌ 3회 초과 → 강제 종료
    else:
        return "retry"            # 🔄 재시도 → HTML Generator
```
